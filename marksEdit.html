<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanni Farhad - Google Maps And Leaflet</title>
    <link rel="stylesheet" href="assets/leaflet/css/icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/style.css?v=1.4">
    <link rel="stylesheet" href="assets/leaflet/css/leaflet.css" />
    <script src="assets/html2canvas.min.js"></script>
    <script src="assets/FileSaver.js"></script>
</head>

<body>
    <div class="container-fluid ">
        <header class="d-flex mb-3 justify-content-center py-3 border-bottom">
          <ul class="nav nav-pills">
            <li class="nav-item"><a href="#" class="nav-link active" aria-current="page">All functionality</a></li>
            <li class="nav-item"><a href="#" class="nav-link">Get & Set Marks</a></li>
            <li class="nav-item"><a href="#" class="nav-link">Adding Marks</a></li>
            <li class="nav-item"><a href="#" class="nav-link">Polygons</a></li>
            <li class="nav-item"><a href="#" class="nav-link">Adding Polygons</a></li>
          </ul>
        </header>
    </div>

    <div class="container-fluid pb-3">
        <div class="d-grid gap-3" style="grid-template-columns: 1fr 2fr;">
          <div class="bg-light border rounded-3">
            <br><br><br><br><br><br><br><br><br><br>
          </div>
          <div class="bg-light border rounded-3">
            <div class="mapwrap">
                <div id="mapid" class="mapBlock"></div>
            </div>
        </div>
        </div>
      </div>

</body>

<script src="assets/leaflet/js/leaflet.js"></script>
<script src="assets/leaflet/js/Easy.Button.js"></script>
<script src="assets/leaflet/js/Leaflet.Editable.js"></script>
<script src="assets/leaflet/js/Leaflet.PolylineMeasure.js"></script>
<script src="assets/leaflet/js/leaflet-routing-machine.js"></script>
<script src="assets/jquery-3.3.1.slim.min.js"></script>
<!-- <script src="assets/custom.js?v=1.6"></script> -->


<script type="text/javascript">

  
  var map = L.map('mapid',  {editable: true}).setView([39.559859, 46.679394], 9);
  var removeRegime = false;
  // mapInit('https://tile.openstreetmap.org/{z}/{x}/{y}.png');
  mapInit('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}');
  
  var fieldsList = [{"id":"3","points":"[[[40.201430776254,49.496614080198],[40.2347092202,49.280400061341],[40.254847443345,49.120986122923],[40.190145736732,48.937021048936],[40.257451260845,48.511187507668],[40.40459947954,48.151141260791],[40.467435895152,47.512410535637],[40.506586015258,47.014696996702],[40.557672393657,46.580432307716],[40.684021162093,46.130210021273],[40.82613554822,45.876667234593],[41.075810685703,45.57270416792],[41.337865815144,45.261218296738],[41.491293967948,44.866946816189],[41.624294803294,44.037916610815],[41.599907606054,43.603914002091],[41.391050518072,43.216454455574],[41.184370452155,42.998023872233],[40.474215415433,42.493732971908],[39.846137739875,41.827621771664],[39.856396931785,41.26661284314]]]","type":"line","opacity":"1","fieldColor":"#326fa8","strokeColor":"#326fa8","name":"South Caucasus Gas Pipeline","description":"South Caucasus Gas Pipeline","lang":"az"},{"id":"4","points":"[[[40.197890942611,49.478450808652],[40.262309457657,49.279641943558],[40.323529730162,49.156864501167],[40.31497055588,49.00423292496],[40.260047987145,48.894976862095],[40.309467770198,48.692026830183],[40.381767811084,48.462128816886],[40.501685284937,48.142933293092],[40.561284863092,47.86477358194],[40.623009294506,47.355883310438],[40.726439432093,46.535328879716],[40.804416085165,46.065503499248],[40.932600309228,45.798962799974],[41.250134451036,45.24761272495],[41.445461289779,44.806604744768],[41.589538935508,44.450227524201],[41.691586542735,43.858444923952],[41.689792263129,43.537246573111],[41.588957053789,43.274242656463],[41.333004073383,43.001938180517],[40.436715753456,42.366328928435],[40.124646448659,42.063091173341],[39.92906846258,41.82306096262],[39.907949236632,41.387986655891],[39.898381492436,41.125256242929],[39.763918738202,40.008143297108],[39.642569373025,39.475267026493],[39.576193342281,38.551825889349],[39.46005437599,38.226793932117],[39.004240784149,37.137027035693],[38.632454462996,36.624482190779],[38.363345673078,36.446566177814],[37.934071889642,36.140186692151],[37.605163544981,36.03651585084],[36.9967566495,35.801434970313]]]","type":"line","opacity":"1","fieldColor":"#4257f5","strokeColor":"#4257f5","name":"Baku\u2013Tbilisi\u2013Ceyhan pipeline","description":"Baku\u2013Tbilisi\u2013Ceyhan pipeline","lang":"az"},{"id":"5","points":"[[[40.183258075746,49.468604194032],[40.325228757563,49.287318513158],[40.398547612097,49.026031656534],[40.319601242018,48.808930023006],[40.365383548215,48.575694190631],[40.497381182622,48.308268035561],[40.565526726231,48.124860497466],[40.65728618684,47.519612150893],[40.72298817295,46.903332245554],[40.996627778804,45.842821218217],[41.107142416723,45.631228899336],[41.319239309057,45.356752536291],[41.387604857663,45.284657260605],[41.494039833591,45.223182025214],[41.669819263425,45.215767469603],[41.794592463509,45.069045584054],[41.853888048986,44.897408505436],[41.864596007915,44.731216420457],[41.833945476559,44.078185398868],[41.877880244847,43.424996219376],[41.915541548246,42.922859662745],[41.997914311073,41.803013647417]]]","type":"line","opacity":"1","fieldColor":"#4257f5","strokeColor":"#4257f5","name":"Baku\u2013Supsa pipeline","description":"Baku\u2013Supsa pipeline","lang":"az"},{"id":"27","points":"[[[40.233412,46.40625],[40.209294,46.360931],[40.205886,46.304626],[40.196446,46.305313],[40.167068,46.30806],[40.147914,46.301193],[40.126391,46.31012],[40.109063,46.315613],[40.080698,46.306],[40.07019,46.338959],[40.068614,46.353378],[40.047591,46.35561],[40.029323,46.334667],[40.006317,46.339302],[40.002372,46.368999],[39.972253,46.401958],[39.953964,46.429596],[39.928168,46.450195],[39.908683,46.443329],[39.882343,46.458435],[39.880762,46.492081],[39.847558,46.515427],[39.825413,46.547012],[39.808536,46.544266],[39.775825,46.557312],[39.75788,46.560745],[39.729898,46.557999],[39.695036,46.579285],[39.659628,46.562977],[39.651037,46.552849],[39.641124,46.532593],[39.621557,46.526413],[39.60463,46.531219],[39.585185,46.520405],[39.580026,46.524868],[39.576453,46.532421],[39.574866,46.540146],[39.570764,46.555939],[39.595636,46.558685],[39.618913,46.561432],[39.625788,46.569672],[39.625259,46.588211],[39.600927,46.602631],[39.597223,46.632156],[39.655927,46.664429],[39.654341,46.709747],[39.654341,46.716614],[39.685525,46.711121],[39.744154,46.729488],[39.756956,46.729832],[39.767117,46.736183],[39.771339,46.750946],[39.765797,46.763649],[39.75656,46.781502],[39.752337,46.792488],[39.753657,46.814804],[39.721976,46.869049],[39.712997,46.873169],[39.707187,46.873169],[39.685525,46.901321],[39.671256,46.916428],[39.646411,46.976166],[39.655399,46.991959],[39.685261,47.028351],[39.702696,47.038136],[39.731482,47.067146],[39.746398,47.078648],[39.74785,47.090664],[39.744418,47.101994],[39.73861,47.112293],[39.733066,47.223015],[39.73795,47.240353],[39.737818,47.250309],[39.774769,47.243271],[39.799568,47.218208],[39.820139,47.203445],[39.850194,47.164993],[39.836486,47.15126],[39.858101,47.101135],[39.867061,47.066803],[39.886558,47.037964],[39.885504,46.997452],[39.891826,46.975479],[39.880762,46.95694],[39.862844,46.955566],[39.848612,46.944237],[39.833059,46.945953],[39.84255,46.911621],[39.827522,46.889992],[39.816448,46.868362],[39.812756,46.85051],[39.823304,46.843643],[39.848085,46.884842],[39.886031,46.922607],[39.897094,46.906815],[39.91079,46.920547],[39.920269,46.911621],[39.91395,46.884155],[39.93396,46.840897],[39.949753,46.83609],[39.958701,46.859436],[39.993956,46.803131],[40.005528,46.787338],[40.002898,46.680908],[40.00658,46.660995],[40.021305,46.667862],[40.030769,46.700821],[40.033924,46.74202],[40.049168,46.778412],[40.067037,46.758499],[40.088053,46.766739],[40.109588,46.785965],[40.098034,46.801758],[40.102761,46.812057],[40.121141,46.812057],[40.132691,46.802444],[40.145289,46.824417],[40.161034,46.83815],[40.16838,46.866302],[40.160509,46.887589],[40.15946,46.905441],[40.184644,46.937027],[40.22083,46.939087],[40.232364,46.95076],[40.250184,46.941833],[40.253853,46.930161],[40.254901,46.876602],[40.268524,46.843643],[40.286859,46.820297],[40.294715,46.812744],[40.320896,46.805878],[40.303618,46.736526],[40.313043,46.662369],[40.336077,46.583405],[40.338694,46.553192],[40.325346,46.52401],[40.282669,46.486588],[40.257652,46.475086],[40.233412,46.40625]]]","type":"field","opacity":"0.25","fieldColor":"#ff0006","strokeColor":"#920202","name":"Rus S\u00fclhm\u0259raml\u0131lar\u0131n\u0131n yerl\u0259\u015fdiyi \u0259razil\u0259r ","description":"Rus S\u00fclhm\u0259raml\u0131lar\u0131n\u0131n yerl\u0259\u015f\u0259c\u0259yi \u0259razil\u0259r ","lang":"az"},{"id":"29","points":"[[[38.894003544658,46.532499579014],[38.902553786493,46.525633123936],[38.897744402138,46.51808002335],[38.897210005991,46.513273504795],[38.891331382961,46.513273504795],[38.888124656222,46.50228717667],[38.893469120361,46.493360785069],[38.898278794263,46.47413471085],[38.894003544658,46.467268255772],[38.900416322551,46.455595282139],[38.90201942654,46.446668890537],[38.899881946511,46.439802435459],[38.898278794263,46.425382879795],[38.895606793421,46.418516424717],[38.896141201632,46.4082167421],[38.905225525935,46.394483831944],[38.911102998796,46.380064276279],[38.916445733645,46.3642714296],[38.92018540873,46.335432318272],[38.913240140999,46.327192572178],[38.907362845099,46.316206244053],[38.90629419356,46.296293524326],[38.904156842224,46.285993841709],[38.895072381188,46.26676776749],[38.887590187691,46.262647894444],[38.88171076846,46.250974920811],[38.874761736643,46.236555365147],[38.871019668825,46.229688910069],[38.867277403994,46.220075872959],[38.864069591623,46.209776190342],[38.857653532678,46.202909735264],[38.85444528611,46.187803534092],[38.849097886887,46.182310370029],[38.845354468241,46.174070623936],[38.845889254393,46.165830877842],[38.844284883877,46.152097967686],[38.845889254393,46.139051703037],[38.850167398892,46.129438665928]]]","type":"line","opacity":"1","fieldColor":"#ff0000","strokeColor":"#000000","name":"Nax\u00e7\u0131van Korridoru","description":"Nax\u00e7\u0131van Korridoru","lang":"az"}];
  var marksInfo = {"id":"46","slug":"police-hadrut","lat":"39.559859","lng":"46.679394","source":"","points":"[{\"lat\":39.51993294050093,\"lng\":47.025604248046875}]","images":[],"media":[],"author":null,"confirmedBy":null,"icon":"8","side":"1","status":"1","startDate":"2020-11-11 17:54:00","endDate":"2020-11-12 19:54:00","createDate":"2020-11-11 16:55:03","texts":{"en":{"id":"167","name":"In accordance with the decree of President Ilham Aliyev \"On the organization of temporary special management in the liberated territories of the Republic of Azerbaijan\", the Khojavend District Police Department was placed in the Hadrut settlement","description":null,"fullstory":null,"lang":"en","updatedBy":null,"type":"mark","parentId":"46"},"az":{"id":"168","name":"Prezident \u0130lham \u018fliyevin \"Az\u0259rbaycan Respublikas\u0131n\u0131n azad edilmi\u015f \u0259razil\u0259rind\u0259 m\u00fcv\u0259qq\u0259ti x\u00fcsusi r\u0259hb\u0259rliyin t\u0259\u015fkili haqq\u0131nda\" f\u0259rman\u0131na uy\u011fun olaraq, Xocav\u0259nd Rayon Polis \u015e\u00f6b\u0259si Hadrut q\u0259s\u0259b\u0259sin\u0259 yerl\u0259\u015fdirildi.","description":null,"fullstory":null,"lang":"az","updatedBy":null,"type":"mark","parentId":"46"}}};
  
  for (key in fieldsList) {
    drawRegions(fieldsList[key], false);
  }
  addMarker(marksInfo, true);
  addCenterMarker(marksInfo.lat,  marksInfo.lng);
  
  L.EditControl = L.Control.extend({
      options: {
        position: 'topleft',
        callback: null,
        kind: '',
        html: ''
      },
      onAdd: function (map) {
        var container = L.DomUtil.create('div', 'leaflet-control leaflet-bar'),
            link = L.DomUtil.create('a', '', container);
  
        link.href = '#';
        link.title = 'Create a new ' + this.options.kind;
        link.innerHTML = this.options.html;
        L.DomEvent.on(link, 'click', L.DomEvent.stop)
                  .on(link, 'click', function () {
                    window.LAYER = this.options.callback.call(map.editTools);
                  }, this);
  
        return container;
      }
  });
  
  L.NewMarkerControl = L.EditControl.extend({
  
      options: {
        position: 'topleft',
        callback: map.editTools.startMarker,
        kind: 'marker',
        html: '🖈'
      }
  
  });
  
  map.addControl(new L.NewMarkerControl());
  
  L.easyButton('icon-trash',function() {
    removeRegime = !removeRegime;
  }, 'Silinmə rejimi').addTo(map);
  
  map.on('editable:created', function (e) {
    var layer = e.layer;
    layer.options.draggable = true;
    layer.options.editable = true;
    layer.on('dblclick', L.DomEvent.stop).on('dblclick',  function(){
                        if(removeRegime){
                          this.remove();
                        }else{
                          this.toggleEdit();
                        }
                      });
    map.addLayer(layer); 
  });
  
  $('#updateMapClick').on('click', function (e) {
    e.preventDefault();
    var allPaths = [];
    map.eachLayer(function (layer) {
      if(layer.options.draggable && !layer.options.centerMark){
        let markData = layer.getLatLng();
        allPaths.push(markData);
      }
  
      if(layer.options.draggable && layer.options.centerMark){
        let markData = layer.getLatLng();
        $('.centerlat').val(markData.lat);
        $('.centerlng').val(markData.lng);
      }
  
    });
    $('#pointsData').val(JSON.stringify(allPaths));
  });
  
  function mapInit(tile){
        L.tileLayer(tile, {
           maxZoom: 18,
           attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ',
           subdomains:['mt0','mt1','mt2','mt3']
        }).addTo(map);
  }
  
  function drawRegions(c, editable){
    let f = null;
    switch (c.type) {
            case 'field':
               c.points = JSON.parse(c.points);
               c.points.forEach(element => {
                     f = L.polygon(element, {
                           'polyId': c.id,
                           type:'area',
                           name:c.name,
                           points: element,
                           editable: editable
                        });
  
                     f.setStyle({
                        clickable: !1,
                        fillColor: c.fieldColor,
                        fillOpacity: c.opacity,
                        color: c.strokeColor,
                        weight: 2,
                        opacity: c.opacity
                     });
                    
                    f.addTo(map);
  
                    if(editable){
                      f.enableEdit();
                      f.on('dblclick', L.DomEvent.stop).on('dblclick',  function(){
                        if(removeRegime){
                          this.remove();
                        }else{
                          this.toggleEdit();
                        }
                      });
                    }
                   
               });
                        
            break;
   
            case 'line':
              c.points = JSON.parse(c.points);
               c.points.forEach(element => {
                 f = L.polyline(element, {
                  editable: editable
                 });
                 f.setStyle({
                     clickable: !1,
                     fillColor: c.fieldColor,
                     fillOpacity: c.opacity,
                     color: c.strokeColor,
                     weight: 2,
                     opacity: c.opacity,
                     
                 });
   
                 if(editable){
                      f.enableEdit();
                      f.on('dblclick', L.DomEvent.stop).on('dblclick', f.toggleEdit);
                    }
                  f.addTo(map);
  
               });
   
            break;
         }
  
  }
  
  function addMarker(marker, draggable){
      marker.points = JSON.parse(marker.points);
  
      marker.points.forEach(point => {
        let mapMark = L.marker([point.lat, point.lng],{
            block_id : marker.id, 
            info:marker,
            icon: generateIconMark(marker, false),
            title:marker.name,
            riseOnHover: !0,
            type:'marker',
            id: marker.id,
            draggable: true
        });
        mapMark.addTo(map);
        
        if(draggable){
          mapMark.enableEdit();
          mapMark.on('dblclick', L.DomEvent.stop).on('dblclick',  function(){
            if(removeRegime){
              this.remove();
            }else{
              this.toggleEdit();
            }
          });
        }
      });
      
  }
  
  function addCenterMarker(lat, lng){
        if(lat && lng){
        }else {
          lat = '39.559859';
          lng = '46.679394';
        }
        let mapMark = L.marker([lat, lng],{
            icon: generateIconMark([], true),
            title:'Center Marks',
            riseOnHover: !0,
            type:'marker',
            centerMark: true,
            draggable: true
        });
        mapMark.addTo(map);
  }
  
  function generateIconMark(info, active){
      return L.divIcon({
          iconSize: [35, 35],
          className: `simpleIcon ${active ? 'avtiveIcon' : ''}`,
          shadowSize: [68, 68],
          shadowAnchor: [22, 22]
      });
  }
  
  
  </script>
  <style>
    .simpleIcon {
      border-radius: 50%;
      padding: 8px 0px;
      font-size: 17px;
      display: flex !important;
      align-items: center;
      justify-content: center;
      background: #333;
  }
  .avtiveIcon{
      box-shadow: 0 0 0 2px #fff !important;
      background: #060 !important;
  }
  </style>
</html>